# ES

:::details 参考资料：

- [Elastic 官方文档](https://www.elastic.co/docs)
- [黑马Elasticsearch全套教程](https://www.bilibili.com/video/BV1b8411Z7w5)

:::

## 操作文档

---

### 1、Document

---

`Document` 是 Elasticsearch 数据的基本单元，类似于 关系型数据库中的一行数据。

一个典型的 ES 文档示例如下：

````json
{
  "id": "1",
  "name": "Java并发编程实战",
  "author": "Brian Goetz",
  "price": 89.00,
  "published_date": "2024-03-01",
  "tags": ["Java", "并发", "编程"],
  "description": "一本讲解Java多线程编程的经典书籍。"
}
````

---

### 2、操作

---

#### 2.1.新增文档

es 中通过 Restful 请求操作文档，请求内容用 DSL 语句来表示。新增一条 document 的 DSL 语法如下：

````json
POST /indexName/_doc/文档id
{
  "fieldName01": "值1",
  "fieldName02": "值2",
  "fieldName03": {
    "fieldName031": "值3",
    "fieldName032": "值4"
  },
  // ...
}
````

示例：

````json
POST /heima/_doc/1
{
  "info":"黑马程序元学java",
  "email":"645299910@qq.com",
  "name":{
    "firstName":"云",
    "lastName":"赵"
  }
}
````

#### 2.2.查询文档

````json
GET /indexName/_doc/documentId
````

示例：

````json
GET /heima/_doc/1
````

结果：

````json
{
  "_id": "1",// 文档的唯一标识符，相当于MySQL中的 主键
  "_index": "heima",// 文档所在的 索引名称
  "_primary_term": 1,// 主分片版本号，在分布式环境中，primary_term 会随着 主分片的重新选举 而增加，用于确保数据一致性
  "_seq_no": 0,// 序列号，每次对文档执行写操作（创建、更新、删除）时，序列号会自增，用于数据的版本控制和冲突检测
  "_source": {// 文档的实际数据内容，存储在 _source 字段中
    "email": "645299910@qq.com",
    "info": "黑马程序元学java",
    "name": {
      "firstName": "云",
      "lastName": "赵"
    }
  },
  "_version": 1,// 表示当前文档的 版本号，每次更新文档时，版本号都会自动增加，用于实现乐观锁
  "found": true // 表示查询是否找到了该文档
}
````

#### 2.3.修改索引库

不能修改 index 中已有的字段，只能添加新的字段到索引中：

````json
// 修改索引库，添加新字段
PUT /heima/_mapping
{
  "properties": {
    "age": {
      "type": "integer"
    }
  }
}
````
